<!doctype html>
<html>
<body>
<script type=module>
import storage from './storage.js';
import {parseQuery} from './util.js';

(async () => {
  // await XRPackageEngine.waitForLoad();

  const q = parseQuery(location.search);
  const {code} = q;
  if (code) {
    const res = await fetch(`https://login.exokit.org/?discordcode=${code}`, {method: 'POST'});
    const j = await res.json();
    const {mnemonic} = j;
    await storage.set('loginToken', {mnemonic});
    location.path = '/ethereum.html';
  } else {
    console.warn('no discord code provided', q);
  }
  /* const {email, code} = q;
  if (email && code && await doLogin(email, code)) {
    delete q.email;
    delete q.code;
    window.location.search = '?' + Object.keys(q).map(k => encodeURIComponent(k) + '=' + encodeURIComponent(q[k])).join('&');
  } else {
    await tryLogin();
  } */
})();

</script>
</body>

</html>
